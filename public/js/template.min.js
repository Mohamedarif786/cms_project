function updateTemplate(e){$("#loader").show(),document.querySelector("#updateUserForm").reset(),$("#template_id").val(e),$.post("/template/get",{id:e},(e=>{if(e.data.template.success){let t=e.data.template.result;$("#subject").val(t.subject),$("#clubid").val(t.clubid),$("#moduleid").val(t.moduleid),$("#language").val(t.language),$("#type").val(t.type),$("#subtype").val(t.subtype),tinymce.get("mail_content").getContent()}else notify(e.data.template.success.message,"error");$("#loader").hide()}))}document.addEventListener("focusin",(e=>{null!==e.target.closest(".tox-tinymce-aux, .moxman-window, .tam-assetmanager-root")&&e.stopImmediatePropagation()})),$(document).ready((function(){$("input, textarea, select").each((function(e,t){$(t).attr("custom_validation")&&(t.addEventListener("invalid",(function(e){e.target.validity.valueMissing&&$(e.target).attr("custom_validation")&&e.target.setCustomValidity($(e.target).attr("custom_validation_msg"))})),t.addEventListener("change",(function(e){e.target.setCustomValidity("")})))}));var e=document.getElementById("addForm");async function t(e,t){switch(t){case"all":const a=await fetch(_apiBase+"/delete/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});let l=await a.json();if(l&&!l.errors)return $("#row"+e).remove(),_CMSpagination.reset(),e;break;default:$.post(_apiBase+"/delete/"+e,{},(function(a){a&&!a.errors?($("#row"+e).remove(),_CMSpagination.reset(),notify("Record Deleted","success")):notify(a.errors[0].message,"error"),t()}));break}}function a(){$("#loader").show();let e=$("#table-body");$("#table-body").empty(),$.get(_apiBase+"/list",{},(function(t){null!=t&&void 0!==t.length?($.get("/templates/template_item.html",(function(a){$.each(t,(function(t,l){$.tmpl(a,l).appendTo(e)})),_CMSpagination=new Pager({divId:"fPage",tableId:"main-table",noContentMsg:"No Content found",filter:!0,deleteAll:function(e){$(".delete-check:checkbox:checked").length>0?($("#deleteModal").modal("show"),$("#delete-confirm").data("id","all")):notify("No record selected for delete","warning")}})})),$("#loader").hide()):($("#table-body").html('<tr><th colspan="6">No data found</th></tr>'),$("#loader").hide())}))}tinymce.init({selector:"#mail_content",plugins:["code"],height:"250"}),$("#add-resource").on("click",(function(){$("#addModal").modal("show")})),$("#clubid").on("change",(function(){$("#loader").show();let e={clubid:$(this).val()};$.post(_apiBase+"/modules",e,(function(e){if(e&&!e.errors&&null!=e.data.modules){let t=$("#moduleid");t.empty(),t.append("<option value=''>Choole Module</option>"),$.each(e.data.modules.result,(function(e,a){t.append($("<option></option>").attr({value:a.id}).text(a.name))}))}$("#loader").hide()}))})),$("#add-confirm").on("click",(function(){if($("#loader").show(),$("#add-confirm").prop("disabled",!0),!e.reportValidity())return e.reportValidity(),$("#loader").hide(),void $("#add-confirm").prop("disabled",!1);let t={subject:$("#subject").val(),type:$("#type").val(),subtype:$("#subtype").val(),language:$("#language").val(),content:tinymce.get("mail_content").getContent()};$("#clubid").val().trim().length>0&&(t.clubid=parseInt($("#clubid").val())),$("#moduleid").val().trim().length>0&&(t.moduleid=parseInt($("#moduleid").val())),""==$("#template_id").val()?$.post(_apiBase+"/add",t,(function(t){$("#addModal").modal("hide"),t.data.addTemplate.success?(notify(t.data.addTemplate.message,"success"),a()):notify(t.data.addTemplate.message,"error"),$("#add-confirm").prop("disabled",!1),e.reset(),$("#loader").hide()})):(t.id=$("#template_id").val(),$.post(_apiBase+"/update",t,(function(t){$("#addModal").modal("hide"),t&&!t.errors?(notify(t.data.addTemplate.message,"success"),t.data.addTemplate.status&&a()):notify(t.errors[0].message,"error"),$("#add-confirm").prop("disabled",!1),e.reset(),$("#loader").hide()})))})),$(document).on("click",".delete-resource",(function(){let e=$(this).data("id");$("#list").empty(),$("#list").append(`<li data-id="${e}">${$(this).data("subject")}</li>`),$("#deleteDialog .modal-title").html("Delete Module"),$("#deleteDialog #bdelete").off("click"),$("#deleteDialog #bdelete").click((()=>{!async function(e){$("#loader").show(),t(e,(()=>{$("#loader").hide(),$("#deleteDialog").modal("hide")}))}(e)})),$("#deleteDialog").modal("show")})),$("#deleteAll").click((()=>{let e=$(".delete-check:checkbox:checked");$("#list").empty();let a=0;$(e).each((function(){this.checked&&(a++,$("#list").append(`<li data-id="${$(this).data("id")}">${$(this).data("subject")}</li>`))})),a>0?($("#deleteDialog .modal-title").html("Delete Menu(s)"),$("#deleteDialog #bdelete").off("click"),$("#deleteDialog #bdelete").click((()=>{!async function(){$("#loader").show();let e=$(".delete-check:checkbox:checked"),a=[];if($(e).each((function(){if(this.checked){let e=parseInt($(this).data("id"));a.push(e)}})),a.length){let e=await Promise.all(a.map((async e=>await t(e,"all"))));e=e.filter((function(e){return void 0!==e})),a.length-e.length==0?notify("Template(s) deleted successfully","success"):notify("Unable to delete Template(s)","warning"),$("#loader").hide()}$("#deleteDialog").modal("hide")}()})),$("#deleteDialog").modal("show")):notify("Template(s) not selected","warning")})),$("#delete-confirm").on("click",(function(){let e=$(this).data("id");"all"!=e?($("#loader").show(),$("#delete-confirm").prop("disabled",!0),t(e,(()=>{$("#deleteModal").modal("hide"),$("#delete-confirm").prop("disabled",!1),$("#loader").hide()}))):($("#deleteModal").modal("hide"),$(".delete-check:checkbox:checked").length>0&&$.each($(".delete-check:checkbox:checked"),(function(e,a){let l=$(a).data("id");$("#loader").show(),t(l,(()=>{$("#loader").hide()}))})))})),a()}));